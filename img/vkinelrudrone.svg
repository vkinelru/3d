<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<svg
   xmlns:dc="http://purl.org/dc/elements/1.1/"
   xmlns:cc="http://creativecommons.org/ns#"
   xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
   xmlns:svg="http://www.w3.org/2000/svg"
   xmlns="http://www.w3.org/2000/svg"
   xmlns:xlink="http://www.w3.org/1999/xlink"
   xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd"
   xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"
   width="2048"
   height="1636"
   viewBox="0 0 2048 1636"
   version="1.1"
   id="svg20"
   sodipodi:docname="vkinelrudrone.svg"
   inkscape:version="1.0.2 (e86c870879, 2021-01-15)">
  <defs
     id="defs13" />
  <title
     id="title214">Схема VKinel.ru</title>
  <sodipodi:namedview
     id="base"
     pagecolor="#ffffff"
     bordercolor="#666666"
     borderopacity="1.0"
     inkscape:pageopacity="0.0"
     inkscape:pageshadow="2"
     inkscape:zoom="0.79007495"
     inkscape:cx="776.65989"
     inkscape:cy="1311.8356"
     inkscape:document-units="px"
     inkscape:current-layer="svg20"
     inkscape:document-rotation="0"
     showgrid="false"
     inkscape:window-width="1920"
     inkscape:window-height="1080"
     inkscape:window-x="0"
     inkscape:window-y="0"
     inkscape:window-maximized="0"
     fit-margin-top="0"
     fit-margin-left="0"
     fit-margin-right="0"
     fit-margin-bottom="0"
     lock-margins="true"
     scale-x="0.10001"
     viewbox-width="526"
     units="mm"
     inkscape:showpageshadow="false"
     showborder="false" />
  <metadata
     id="metadata17">
    <rdf:RDF>
      <cc:Work
         rdf:about="">
        <dc:format>image/svg+xml</dc:format>
        <dc:type
           rdf:resource="http://purl.org/dc/dcmitype/StillImage" />
        <dc:title>VKinel.ru</dc:title>
        <dc:creator>
          <cc:Agent>
            <dc:title>VKinelru</dc:title>
          </cc:Agent>
        </dc:creator>
        <dc:rights>
          <cc:Agent>
            <dc:title>ВКинельРу</dc:title>
          </cc:Agent>
        </dc:rights>
        <dc:publisher>
          <cc:Agent>
            <dc:title>ВКинель.Ру</dc:title>
          </cc:Agent>
        </dc:publisher>
        <dc:identifier>ВКинельРу</dc:identifier>
        <dc:source>ВКинель.Ру</dc:source>
        <dc:date>2025</dc:date>
      </cc:Work>
    </rdf:RDF>
  </metadata>
  <image
     width="2048"
     height="1636"
     style="display:inline;opacity:1"
     xlink:href="https://vkinelru.github.io/3d/img/kupi.VKinel.ru-doma-i-horizont-full-remaker_ai.jpeg"
     id="jpegback"
     x="0"
     y="0"
     inkscape:svg-dpi="1" />
  <path
     style="fill:none;stroke:#ff0000;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1"
     d="m 1414.3208,1462.6499 30.4262,-251.4047 -281.4448,-26.7336 -12.4693,38.0573 -93.4997,-22.6566 -127.01585,198.8853 152.12575,30.5525 181.8754,24.6451 z"
     id="singapur"
     sodipodi:nodetypes="ccccccccc" />
  <style
     type="text/css"
     id="style"><![CDATA[
svg {
width:100%;
height:100%;
margin: 0 !important;
padding: 0 !important;
border: 0 !important;
}

path {
    stroke-width: 10.0px !important;
    animation: pulseColor 6s infinite ease-in-out;
}

@keyframes pulseColor {
    000% { stroke: #F009; fill:#0000; }
    050% { stroke: #000F; fill:#F009; }
    100% { stroke: #F009; fill:#0000; }
}

text {
    pointer-events: none; /* Предотвращает взаимодействие с текстом при вращении */
}

.textfade {
    animation: fadeOutText 13s ease forwards;
}

@keyframes fadeOutText {
    0% {
        opacity: 1;
    }
    80% { 
        opacity: 0.85;
        filter: blur(0px);
    }
    100% {
        opacity: 0;
        filter: blur(6px);
    }
}
]]></style>
  <script
     id="vkinelrujs"><![CDATA[
    
document.addEventListener('keydown', function(event) {
    const svgRoot = document.documentElement;
    let currentRotation = parseFloat(svgRoot.getAttribute('data-rotation') || '0');
    
    if (event.key === 'a' || event.key === 'A') {
        currentRotation -= 0.5; // Поворот влево
    } else if (event.key === 'd' || event.key === 'D') {
        currentRotation += 0.5; // Поворот вправо
    }
    
    svgRoot.setAttribute('data-rotation', currentRotation);
    svgRoot.style.transform = `rotate(${currentRotation}deg)`;
});

    // Получаем корневой SVG элемент
    const svgRoot = document.documentElement;
    const originalTitle = svgRoot.getAttribute('title') || 'Vkinel.ru';
    
    // Находим все path элементы
    const paths = svgRoot.querySelectorAll('path');

    paths.forEach(path => {
        // Обработчик наведения
        path.addEventListener('mouseover', function() {
            const pathId = this.getAttribute('id') || '(без id)';
            svgRoot.setAttribute('title', pathId);
            document.title = pathId;
        });

        path.addEventListener('mouseout', function() {
            svgRoot.setAttribute('title', originalTitle);
            document.title = originalTitle;
        });

        // Обработчик клика
        path.addEventListener("click", function (event) {
            const pathId = path.id || "(без id)";
            const length = path.getTotalLength();
            let points = [];

            for (let i = 0; i <= length; i += 1) {
                const { x, y } = path.getPointAtLength(i);
                points.push({ x, y });
            }

            if (points.length < 3) {
                alert(`Path ID: ${pathId}\nНе хватает точек для вычисления площади`);
                return;
            }

            console.log(`ID: ${pathId}`);
            console.log(`Количество точек: ${points.length}`);

            let area = 0;
            for (let i = 0; i < points.length - 1; i++) {
                area += (points[i].x * points[i + 1].y) - (points[i + 1].x * points[i].y);
            }
            area = Math.abs(area) / 2;
            area = area / 5.24382628733;

            console.log(`Площадь: ${area.toFixed(2)} м²`);

            // Создаем текстовый элемент
            const svgNS = "http://www.w3.org/2000/svg";
            const text = document.createElementNS(svgNS, "text");

            // Получаем оригинальный цвет stroke из атрибута style
            const style = path.getAttribute('style');
            let pathColor = '#000000'; // Цвет по умолчанию, если stroke не найден
            if (style) {
                const strokeMatch = style.match(/stroke:#[0-9A-Fa-f]{6}/) || style.match(/stroke:#[0-9A-Fa-f]{3}/);
                if (strokeMatch) {
                    pathColor = strokeMatch[0].replace('stroke:', '');
                }
            }
            text.setAttribute("fill", pathColor); // Устанавливаем оригинальный цвет
            text.setAttribute("stroke", "#999D");        // Цвет обводки
            text.setAttribute("stroke-width", "1.5");      // Толщина обводки
            text.setAttribute("paint-order", "stroke");  // Обводка рисуется под заливкой            
            text.setAttribute("class", "textfade");        // Цвет обводки

            // Корректируем координаты клика
            const point = svgRoot.createSVGPoint();
            point.x = event.clientX;
            point.y = event.clientY;
            const ctm = svgRoot.getScreenCTM();
            const svgPoint = point.matrixTransform(ctm.inverse());

            text.setAttribute("x", svgPoint.x);
            text.setAttribute("y", svgPoint.y);
            text.setAttribute("font-size", "8");
            text.textContent = `${pathId}: ${area.toFixed(2)} м²`;

            // Добавляем текст в SVG
            svgRoot.appendChild(text);

            // Удаляем текст через 13 секунд
            setTimeout(() => {
                svgRoot.removeChild(text);
            }, 13000);

            // Оставляем старую анимацию линий
            const svg = document.createElementNS(svgNS, "svg");
            const parentSvg = path.ownerSVGElement;
            svg.setAttribute("width", parentSvg.getAttribute("width"));
            svg.setAttribute("height", parentSvg.getAttribute("height"));
            svg.style.position = "absolute";
            svg.style.top = "0";
            svg.style.left = "0";
            svg.style.pointerEvents = "none";
            parentSvg.appendChild(svg);

            const line = document.createElementNS(svgNS, "line");
            line.setAttribute("stroke-width", "7");
            svg.appendChild(line);

            function getRandomColor() {
                const letters = "0123456789ABCDEF";
                let color = "#";
                for (let i = 0; i < 6; i++) {
                    color += letters[Math.floor(Math.random() * 16)];
                }
                return color;
            }

            function drawLine() {
                let i = 0;
                function moveLine() {
                    if (i < points.length) {
                        line.setAttribute("x1", points[i].x);
                        line.setAttribute("y1", points[i].y);
                        line.setAttribute("x2", i === points.length - 1 ? points[0].x : points[i + 1].x);
                        line.setAttribute("y2", i === points.length - 1 ? points[0].y : points[i + 1].y);
                        line.setAttribute("stroke", getRandomColor());
                        i++;
                        setTimeout(moveLine, 13);
                    } else {
                        setTimeout(() => {
                            parentSvg.removeChild(svg);
                        }, 100);
                    }
                }
                moveLine();
            }

            drawLine();
        });
    });
    
    
]]></script>
</svg>
