<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<svg
   xmlns:dc="http://purl.org/dc/elements/1.1/"
   xmlns:cc="http://creativecommons.org/ns#"
   xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
   xmlns:svg="http://www.w3.org/2000/svg"
   xmlns="http://www.w3.org/2000/svg"
   xmlns:xlink="http://www.w3.org/1999/xlink"
   xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd"
   xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"
   width="229.85072mm"
   height="148.50945mm"
   viewBox="0 0 526.34441 340.07775"
   version="1.1"
   id="svg20"
   sodipodi:docname="vkinelrumap.svg"
   inkscape:version="1.0.2 (e86c870879, 2021-01-15)">
  <defs
     id="defs13" />
  <title
     id="title214">Схема VKinel.ru</title>
  <sodipodi:namedview
     id="base"
     pagecolor="#ffffff"
     bordercolor="#666666"
     borderopacity="1.0"
     inkscape:pageopacity="0.0"
     inkscape:pageshadow="2"
     inkscape:zoom="5.0318527"
     inkscape:cx="331.78496"
     inkscape:cy="272.13084"
     inkscape:document-units="px"
     inkscape:current-layer="layer1"
     inkscape:document-rotation="0"
     showgrid="false"
     inkscape:window-width="1718"
     inkscape:window-height="1078"
     inkscape:window-x="200"
     inkscape:window-y="0"
     inkscape:window-maximized="0"
     fit-margin-top="0"
     fit-margin-left="0"
     fit-margin-right="0"
     fit-margin-bottom="0"
     lock-margins="true"
     scale-x="0.10001"
     viewbox-width="526"
     units="mm"
     inkscape:showpageshadow="false"
     showborder="false" />
  <metadata
     id="metadata17">
    <rdf:RDF>
      <cc:Work
         rdf:about="">
        <dc:format>image/svg+xml</dc:format>
        <dc:type
           rdf:resource="http://purl.org/dc/dcmitype/StillImage" />
        <dc:title>VKinel.ru</dc:title>
        <dc:creator>
          <cc:Agent>
            <dc:title>VKinelru</dc:title>
          </cc:Agent>
        </dc:creator>
        <dc:rights>
          <cc:Agent>
            <dc:title>ВКинельРу</dc:title>
          </cc:Agent>
        </dc:rights>
        <dc:publisher>
          <cc:Agent>
            <dc:title>ВКинель.Ру</dc:title>
          </cc:Agent>
        </dc:publisher>
        <dc:identifier>ВКинельРу</dc:identifier>
        <dc:source>ВКинель.Ру</dc:source>
        <dc:date>2025</dc:date>
      </cc:Work>
    </rdf:RDF>
  </metadata>
  <g
     inkscape:label="Layer 1"
     inkscape:groupmode="layer"
     id="layer1"
     style="display:inline">
    <image
       width="526.34442"
       height="340.07776"
       style="display:inline;opacity:1"
       xlink:href="https://vkinelru.github.io/3d/img/vkinelrumap3.jpg"
       id="jpegback"
       x="0"
       y="0"
       inkscape:svg-dpi="1"
       sodipodi:insensitive="true" />
    <path
       style="display:inline;fill:none;stroke:#000000;stroke-width:0.60588px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1"
       d="M 0,0 V 340.07776 H 526.34442 V 0 Z"
       id="Граница_карты" />
    <path
       style="fill:none;stroke:#000000;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1;stroke-width:1;stroke-miterlimit:4;stroke-dasharray:6.00000001,1;stroke-dashoffset:0"
       d="m 186.19334,57.124202 78.61034,50.195438 65.38822,88.50949 -114.08734,91.99046 -54.85271,-121.9305 -15.66258,-77.368856 z"
       id="Вся_территория_VKinelru" />
    <path
       style="fill:none;stroke:#ff0000;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1"
       d="m 249.88543,179.21152 4.42204,4.99363 -3.51956,2.88804 7.44551,7.98735 2.71944,-2.03758 16.00038,20.25627 28.63753,-24.61152 -6.06922,-6.32694 8.28869,-6.66618 -10.10049,-10.98938 -5.89503,5.70641 0.57849,-2.75661 -4.19337,-4.29998 -4.08501,1.46291 1.70186,-4.75472 -3.99078,-3.80748 -4.20121,1.26677 -2.56347,-3.06696 z"
       id="Сингапур" />
    <path
       style="fill:none;stroke:#0000ff;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1"
       d="m 175.35735,149.81868 24.27126,30.25135 20.88319,-14.56184 2.45163,3.57597 9.62842,-8.54527 -2.33961,-4.29514 4.69587,-3.39337 -28.01741,-32.88217 z"
       id="Валенсия"
       sodipodi:nodetypes="ccccccccc" />
    <path
       style="fill:none;stroke:#ff0000;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1"
       d="m 192.45254,108.73814 8.49039,8.81927 -24.60886,21.55709 -9.72806,-10.23814 z"
       id="Баня" />
    <path
       style="fill:none;stroke:#00ff00;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1"
       d="m 223.22738,100.04131 28.21693,24.89323 -4.94297,5.01077 4.55743,9.08198 -16.73477,14.35165 -30.93743,-35.90963 2.36743,-2.27898 -3.01349,-3.15875 5.15462,-4.49568 3.28021,3.17726 z"
       id="Ливерпуль"
       sodipodi:nodetypes="ccccccccccc" />
    <path
       style="fill:none;stroke:#ffff00;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1"
       d="m 198.11786,195.18567 18.02818,28.17849 12.03016,-8.16211 -20.88832,-26.15092 z"
       id="Газифицированный_дом" />
    <path
       style="fill:none;stroke:#f90000;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1;stroke-width:1;stroke-miterlimit:4;stroke-dasharray:6.00000001,1;stroke-dashoffset:0"
       d="m 286.50431,137.86752 -53.28318,38.91632 10.38763,13.95139 -15.68437,11.26325 31.78346,50.5154 73.08813,-55.5409 z"
       id="Сингапур_территория" />
    <path
       style="fill:none;stroke:#00f900;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1;stroke-width:0.60588001;stroke-miterlimit:4;stroke-dasharray:3.63528004, 0.60588001000000002;stroke-dashoffset:0"
       d="m 186.11932,54.537735 80.10042,50.658265 13.0331,16.05233 -42.97308,34.85349 -33.43145,-35.89636 -3.19942,-9.44297 -36.47183,-39.298373 z"
       id="Ливерпуль_территория" />
    <path
       style="fill:none;stroke:#ffff00;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1;stroke-width:0.99970201;stroke-miterlimit:4;stroke-dasharray:5.99821206,0.99970201;stroke-dashoffset:0"
       d="m 214.7869,180.66435 -36.61877,22.48994 36.1844,89.04769 47.64734,-37.17965 z"
       id="Газифицированный_дом_территория"
       sodipodi:nodetypes="ccccc" />
    <path
       style="fill:none;stroke:#ff0000;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1;stroke-width:1;stroke-miterlimit:4;stroke-dasharray:6.00000001,1;stroke-dashoffset:0"
       d="m 143.34971,87.327849 12.04628,67.726901 45.05626,-32.06023 -39.31134,-49.863839 z"
       id="Баня_территория" />
    <path
       style="fill:none;stroke:#0000f8;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1;stroke-width:0.60588001;stroke-miterlimit:4;stroke-dasharray:3.63528004, 0.60588001000000002;stroke-dashoffset:0"
       d="m 155.49494,158.84036 56.49914,-38.47603 32.39084,44.30901 -70.35264,39.51249 z"
       id="Валенсия_территория" />
  </g>
  <style
     type="text/css"
     id="style"><![CDATA[
svg {
width:100%;
height:100%;
margin: 0 !important;
padding: 0 !important;
border: 0 !important;
}


path {
    transition: stroke 0.1s ease;
    stroke-width: 1.0px !important;
    stroke: black;
}

path:hover {
    stroke-width: 3px;
    animation: pulseColor 1.4s infinite;
}

@keyframes pulseColor {
    000% { stroke: #000; fill:#F002; }
    050% { stroke: #F00; fill:#0002; }
    100% { stroke: #000; fill:#F002; }
}

text {
    pointer-events: none; /* Предотвращает взаимодействие с текстом при вращении */
}

.textfade {
    animation: fadeOutText 13s ease forwards;
}

@keyframes fadeOutText {
    0% {
        opacity: 1;
    }
    80% { 
        opacity: 0.75;
    }
    100% {
        opacity: 0;
    }
}
]]></style>



<script id="vkinelrujs"><![CDATA[
    
document.addEventListener('keydown', function(event) {
    const svgRoot = document.documentElement;
    let currentRotation = parseFloat(svgRoot.getAttribute('data-rotation') || '0');
    
    if (event.key === 'a' || event.key === 'A') {
        currentRotation -= 5; // Поворот влево
    } else if (event.key === 'd' || event.key === 'D') {
        currentRotation += 5; // Поворот вправо
    }
    
    svgRoot.setAttribute('data-rotation', currentRotation);
    svgRoot.style.transform = `rotate(${currentRotation}deg)`;
});

    // Получаем корневой SVG элемент
    const svgRoot = document.documentElement;
    const originalTitle = svgRoot.getAttribute('title') || 'Vkinel.ru';
    
    // Находим все path элементы
    const paths = svgRoot.querySelectorAll('path');

    paths.forEach(path => {
        // Обработчик наведения
        path.addEventListener('mouseover', function() {
            const pathId = this.getAttribute('id') || '(без id)';
            svgRoot.setAttribute('title', pathId);
            document.title = pathId;
        });

        path.addEventListener('mouseout', function() {
            svgRoot.setAttribute('title', originalTitle);
            document.title = originalTitle;
        });

        // Обработчик клика
        path.addEventListener("click", function (event) {
            const pathId = path.id || "(без id)";
            const length = path.getTotalLength();
            let points = [];

            for (let i = 0; i <= length; i += 1) {
                const { x, y } = path.getPointAtLength(i);
                points.push({ x, y });
            }

            if (points.length < 3) {
                alert(`Path ID: ${pathId}\nНе хватает точек для вычисления площади`);
                return;
            }

            console.log(`ID: ${pathId}`);
            console.log(`Количество точек: ${points.length}`);

            let area = 0;
            for (let i = 0; i < points.length - 1; i++) {
                area += (points[i].x * points[i + 1].y) - (points[i + 1].x * points[i].y);
            }
            area = Math.abs(area) / 2;
            area = area / 5.24382628733;

            console.log(`Площадь: ${area.toFixed(2)} м²`);

            // Создаем текстовый элемент
            const svgNS = "http://www.w3.org/2000/svg";
            const text = document.createElementNS(svgNS, "text");

            // Получаем оригинальный цвет stroke из атрибута style
            const style = path.getAttribute('style');
            let pathColor = '#000000'; // Цвет по умолчанию, если stroke не найден
            if (style) {
                const strokeMatch = style.match(/stroke:#[0-9A-Fa-f]{6}/) || style.match(/stroke:#[0-9A-Fa-f]{3}/);
                if (strokeMatch) {
                    pathColor = strokeMatch[0].replace('stroke:', '');
                }
            }
            text.setAttribute("fill", pathColor); // Устанавливаем оригинальный цвет
            text.setAttribute("stroke", "#999D");        // Цвет обводки
            text.setAttribute("stroke-width", "1.5");      // Толщина обводки
            text.setAttribute("paint-order", "stroke");  // Обводка рисуется под заливкой            
            text.setAttribute("class", "textfade");        // Цвет обводки

            // Корректируем координаты клика
            const point = svgRoot.createSVGPoint();
            point.x = event.clientX;
            point.y = event.clientY;
            const ctm = svgRoot.getScreenCTM();
            const svgPoint = point.matrixTransform(ctm.inverse());

            text.setAttribute("x", svgPoint.x);
            text.setAttribute("y", svgPoint.y);
            text.setAttribute("font-size", "8");
            text.textContent = `${pathId}: ${area.toFixed(2)} м²`;

            // Добавляем текст в SVG
            svgRoot.appendChild(text);

            // Удаляем текст через 13 секунд
            setTimeout(() => {
                svgRoot.removeChild(text);
            }, 13000);

            // Оставляем старую анимацию линий
            const svg = document.createElementNS(svgNS, "svg");
            const parentSvg = path.ownerSVGElement;
            svg.setAttribute("width", parentSvg.getAttribute("width"));
            svg.setAttribute("height", parentSvg.getAttribute("height"));
            svg.style.position = "absolute";
            svg.style.top = "0";
            svg.style.left = "0";
            svg.style.pointerEvents = "none";
            parentSvg.appendChild(svg);

            const line = document.createElementNS(svgNS, "line");
            line.setAttribute("stroke-width", "10");
            svg.appendChild(line);

            function getRandomColor() {
                const letters = "0123456789ABCDEF";
                let color = "#";
                for (let i = 0; i < 6; i++) {
                    color += letters[Math.floor(Math.random() * 16)];
                }
                return color;
            }

            function drawLine() {
                let i = 0;
                function moveLine() {
                    if (i < points.length) {
                        line.setAttribute("x1", points[i].x);
                        line.setAttribute("y1", points[i].y);
                        line.setAttribute("x2", i === points.length - 1 ? points[0].x : points[i + 1].x);
                        line.setAttribute("y2", i === points.length - 1 ? points[0].y : points[i + 1].y);
                        line.setAttribute("stroke", getRandomColor());
                        i++;
                        setTimeout(moveLine, 13);
                    } else {
                        setTimeout(() => {
                            parentSvg.removeChild(svg);
                        }, 100);
                    }
                }
                moveLine();
            }

            drawLine();
        });
    });
    
    
]]></script>

</svg>
